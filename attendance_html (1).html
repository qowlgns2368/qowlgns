<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²¨ìš¸ë°©í•™ ììœ¨í•™ìŠµ ì¶œì„ì²´í¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f9fafb; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
        h1 { font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 24px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .control-group label { display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 8px; }
        .btn-group { display: flex; gap: 8px; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: #e5e7eb; color: #374151; }
        .btn-secondary:hover { background: #d1d5db; }
        .btn-secondary.active { background: #2563eb; color: white; }
        .date-info { background: #dbeafe; border: 1px solid #93c5fd; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .date-display { font-size: 20px; font-weight: bold; color: #1e40af; margin-bottom: 8px; }
        .time-display { font-size: 16px; font-weight: 600; color: #374151; }
        .stats { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; font-size: 14px; color: #6b7280; }
        .legend { display: flex; gap: 16px; font-size: 12px; align-items: center; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-box { width: 12px; height: 12px; border-radius: 2px; }
        .bg-green { background: #22c55e; }
        .bg-orange { background: #f97316; }
        .bg-gray { background: #1f2937; }
        .bg-red { background: #ef4444; }
        .bg-light { background: #e5e7eb; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f3f4f6; border-bottom: 2px solid #d1d5db; }
        th { padding: 12px 16px; text-align: left; font-size: 14px; font-weight: 600; color: #374151; }
        th.center { text-align: center; }
        td { padding: 12px 16px; font-size: 14px; color: #1f2937; border-bottom: 1px solid #e5e7eb; }
        td.center { text-align: center; }
        tr:hover { background: #f9fafb; }
        .attendance-btn { padding: 8px 24px; border: none; border-radius: 8px; font-weight: 500; color: white; cursor: pointer; transition: opacity 0.2s; }
        .attendance-btn:hover { opacity: 0.8; }
        .download-btn { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #16a34a; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .download-btn:hover { background: #15803d; }
        .download-btn[style*="dc2626"]:hover { background: #b91c1c !important; }
        input[type="date"] { padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .excused-info { color: #dc2626; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ê²¨ìš¸ë°©í•™ ììœ¨í•™ìŠµ ì¶œì„ì²´í¬</h1>
            
            <div class="controls">
                <div class="control-group">
                    <label>í•™ë…„ ì„ íƒ</label>
                    <div class="btn-group">
                        <button class="btn btn-secondary active" onclick="selectGrade('all')">ì „ì²´</button>
                        <button class="btn btn-secondary" onclick="selectGrade('1')">1í•™ë…„</button>
                        <button class="btn btn-secondary" onclick="selectGrade('2')">2í•™ë…„</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>ì‹œê°„ ì„ íƒ</label>
                    <div class="btn-group">
                        <button class="btn btn-secondary active" onclick="selectTime('ì˜¤ì „')">ì˜¤ì „ (08:30-11:50)</button>
                        <button class="btn btn-secondary" onclick="selectTime('ì˜¤í›„')">ì˜¤í›„ (13:00-16:00)</button>
                    </div>
                </div>
            </div>
            
            <div class="date-info">
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 4px; display: block;">ë‚ ì§œ ì„ íƒ</label>
                    <input type="date" id="dateInput" onchange="updateDisplay()">
                </div>
                <div class="date-display" id="dateDisplay"></div>
                <div class="time-display" id="timeDisplay"></div>
            </div>
            
            <div class="stats">
                <div>
                    ì´ <strong style="color: #2563eb;" id="totalCount">0</strong>ëª…
                    <span class="legend">
                        <span class="legend-item"><span class="legend-box bg-green"></span>ì¶œì„</span>
                        <span class="legend-item"><span class="legend-box bg-orange"></span>ì§€ê°</span>
                        <span class="legend-item"><span class="legend-box bg-gray"></span>ë¶ˆì°¸</span>
                        <span class="legend-item"><span class="legend-box bg-red"></span>ê²°ì„</span>
                    </span>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="download-btn" style="background: #dc2626;" onclick="window.resetAttendance()">
                        <span>ğŸ”„</span> ì´ˆê¸°í™”
                    </button>
                    <button class="download-btn" onclick="window.downloadCSV()">
                        <span>ğŸ“¥</span> ì¶œì„ë¶€ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>í•™ë²ˆ</th>
                        <th>ì´ë¦„</th>
                        <th class="center">ì¶œì„ ì²´í¬</th>
                        <th class="center">ë¶ˆì°¸ ì •ë³´</th>
                    </tr>
                </thead>
                <tbody id="studentTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        const grade1Data = [
            { í•™ë²ˆ: '10102', ì´ë¦„: 'ê¹€ë„ìœ¤', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10103', ì´ë¦„: 'ê¹€ë„í›ˆ', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10106', ì´ë¦„: 'ê¹€ì¬í˜„', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10115', ì´ë¦„: 'ì´ê±´ìƒ', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10116', ì´ë¦„: 'ì´ê¸°í˜', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10117', ì´ë¦„: 'ì´ì„œì¤€', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10119', ì´ë¦„: 'ì´ìœ¤ì°¬', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10123', ì´ë¦„: 'ê¹€ë³´ì„±', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10223', ì´ë¦„: 'ì´ì„œì¤€', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10306', ì´ë¦„: 'ì´ìŠ¹ì¤€', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10320', ì´ë¦„: 'ì¡°í˜„ì„', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10505', ì´ë¦„: 'ê¶Œê°€ì—°', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ìˆ˜ ì˜¤ì „/ì˜¤í›„' },
            { í•™ë²ˆ: '10508', ì´ë¦„: 'ê¹€ìœ¤ì±„', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤ì „' },
            { í•™ë²ˆ: '10513', ì´ë¦„: 'ë°•ì§€í›„', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤í›„' },
            { í•™ë²ˆ: '10516', ì´ë¦„: 'ì´ì§€ìš°', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10601', ì´ë¦„: 'ê¹€ì„¸ì—°', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10608', ì´ë¦„: 'ìœ ì§€ì›', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10609', ì´ë¦„: 'ì´ë‚˜ìš´', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10611', ì´ë¦„: 'ì´ë£¨ë¦¬', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ëª© ì˜¤í›„' },
            { í•™ë²ˆ: '10612', ì´ë¦„: 'ì´ì†Œìœ¤', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10613', ì´ë¦„: 'ì´ì˜ì¸', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10618', ì´ë¦„: 'ì •í¬ë€', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10619', ì´ë¦„: 'ìµœì§„ê²½', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10805', ì´ë¦„: 'ê¹€ë³´ë¯¸', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'í™” ì˜¤í›„' },
            { í•™ë²ˆ: '10815', ì´ë¦„: 'ìœ ì œë‹ˆ', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10901', ì´ë¦„: 'ê¹€ë¯¼ì„œ', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤ì „' },
            { í•™ë²ˆ: '10903', ì´ë¦„: 'ê¹€ì‹œí˜„', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤ì „/ì˜¤í›„' },
            { í•™ë²ˆ: '10904', ì´ë¦„: 'ê¹€í•˜ëŒ', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤ì „' },
            { í•™ë²ˆ: '10905', ì´ë¦„: 'ì„œí•˜ì€', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '10907', ì´ë¦„: 'ìœ ë¯¼ì •', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤ì „' },
            { í•™ë²ˆ: '10910', ì´ë¦„: 'ì´ë‚˜ìœ¤', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: 'ê¸ˆ ì˜¤ì „' }
        ];

        const grade2Data = [
            { í•™ë²ˆ: '20101', ì´ë¦„: 'ê¹€ë™í•˜', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20113', ì´ë¦„: 'ì´ì¬ê²½', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20215', ì´ë¦„: 'ì •ë¯¼ê·œ', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20301', ì´ë¦„: 'ê¹€ì„ ìš°', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20307', ì´ë¦„: 'ë°•ì´ì—˜', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20313', ì´ë¦„: 'ìœ¤ì—¬ëª…', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20418', ì´ë¦„: 'ìœ¤ì£¼ì„±', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20714', ì´ë¦„: 'ì´ìœ ì˜¨', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20801', ì´ë¦„: 'ê°•ë‹¤ì—°', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20802', ì´ë¦„: 'ê°•ì„œìœ ', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20807', ì´ë¦„: 'ê¹€ë¯¼ì„œ', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20810', ì´ë¦„: 'ì„œì¤€ì˜', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20811', ì´ë¦„: 'ì„œì§€ë¯¼', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '20815', ì´ë¦„: 'ì´ì„œìœ¤', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '21005', ì´ë¦„: 'ê¹€ì±„ì˜', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ì¢…ì¼', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '21010', ì´ë¦„: 'ë°±ì†Œì€', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '21020', ì´ë¦„: 'ì´ì˜ˆë‹´', ì •ìƒìš´ì˜: 'ì¢…ì¼', ì—°ì¥ìš´ì˜: 'ë¯¸ì°¸ì—¬', ë¶ˆì°¸: '-' },
            { í•™ë²ˆ: '21022', ì´ë¦„: 'ì •ì±„ë¦°', ì •ìƒìš´ì˜: 'ì˜¤ì „', ì—°ì¥ìš´ì˜: 'ì˜¤ì „', ë¶ˆì°¸: '-' }
        ];

        let state = {
            grade: 'all',
            time: 'ì˜¤ì „',
            date: new Date().toISOString().split('T')[0],
            attendance: {}
        };

        function init() {
            document.getElementById('dateInput').value = state.date;
            updateDisplay();
            setInterval(updateTime, 1000);
            setInterval(autoAbsent, 1000);
        }

        function selectGrade(grade) {
            state.grade = grade;
            document.querySelectorAll('.controls .btn-group')[0].querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderTable();
        }

        function selectTime(time) {
            state.time = time;
            document.querySelectorAll('.controls .btn-group')[1].querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            updateDisplay();
            renderTable();
        }

        function updateDisplay() {
            state.date = document.getElementById('dateInput').value;
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const date = new Date(state.date);
            const dayOfWeek = days[date.getDay()];
            document.getElementById('dateDisplay').textContent = `${state.date} (${dayOfWeek}ìš”ì¼) - ${state.time}`;
            renderTable();
        }

        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            document.getElementById('timeDisplay').textContent = `í˜„ì¬ ì‹œê°„: ${timeStr}`;
        }

        function getDisplayData() {
            if (state.grade === '1') return grade1Data;
            if (state.grade === '2') return grade2Data;
            return [...grade1Data, ...grade2Data].sort((a, b) => a.í•™ë²ˆ.localeCompare(b.í•™ë²ˆ));
        }

        function getDayOfWeek(dateStr) {
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const date = new Date(dateStr);
            return days[date.getDay()];
        }

        function isExcusedTime(student) {
            if (student.ë¶ˆì°¸ === '-') return false;
            const dayOfWeek = getDayOfWeek(state.date);
            const excusedInfo = student.ë¶ˆì°¸;
            if (excusedInfo.includes(dayOfWeek)) {
                if (state.time === 'ì˜¤ì „' && excusedInfo.includes('ì˜¤ì „')) return true;
                if (state.time === 'ì˜¤í›„' && excusedInfo.includes('ì˜¤í›„')) return true;
            }
            return false;
        }

        function isLateTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const currentTimeInMinutes = hours * 60 + minutes;
            
            if (state.time === 'ì˜¤ì „') {
                return currentTimeInMinutes > 8 * 60 + 30;
            }
            if (state.time === 'ì˜¤í›„') {
                return currentTimeInMinutes > 13 * 60;
            }
            return false;
        }

        function isAbsentTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const currentTimeInMinutes = hours * 60 + minutes;
            
            if (state.time === 'ì˜¤ì „') {
                return currentTimeInMinutes > 8 * 60 + 45;
            }
            if (state.time === 'ì˜¤í›„') {
                return currentTimeInMinutes > 13 * 60 + 15;
            }
            return false;
        }

        function isTimeOver() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const currentTimeInMinutes = hours * 60 + minutes;
            
            if (state.time === 'ì˜¤ì „') {
                return currentTimeInMinutes > 11 * 60 + 50; // 11:50
            }
            if (state.time === 'ì˜¤í›„') {
                return currentTimeInMinutes > 16 * 60; // 16:00
            }
            return false;
        }

        function autoAbsent() {
            // ì‹œê°„ì´ ì¢…ë£Œë˜ë©´ ëª¨ë“  ì¶œì„ ì •ë³´ë¥¼ ë¯¸ì²´í¬ë¡œ ì´ˆê¸°í™”
            if (isTimeOver()) {
                const data = getDisplayData();
                let hasChanges = false;
                
                data.forEach(student => {
                    const key = `${state.date}-${state.time}-${student.í•™ë²ˆ}`;
                    const manualKey = key + '_manual';
                    
                    if (state.attendance[key]) {
                        delete state.attendance[key];
                        delete state.attendance[manualKey];
                        hasChanges = true;
                    }
                });
                
                if (hasChanges) {
                    renderTable();
                }
                return;
            }
            
            // ê²°ì„ ì‹œê°„ì´ ì§€ë‚¬ì„ ë•Œ ë¯¸ì²´í¬ë¥¼ ê²°ì„ìœ¼ë¡œ ë³€ê²½
            if (!isAbsentTime()) return;
            
            const data = getDisplayData();
            let hasChanges = false;
            
            data.forEach(student => {
                const key = `${state.date}-${state.time}-${student.í•™ë²ˆ}`;
                const currentStatus = state.attendance[key];
                
                if (!currentStatus && !isExcusedTime(student)) {
                    state.attendance[key] = 'absent';
                    hasChanges = true;
                }
            });
            
            if (hasChanges) {
                renderTable();
            }
        }

        function toggleAttendance(í•™ë²ˆ, student) {
            const key = `${state.date}-${state.time}-${í•™ë²ˆ}`;
            let currentStatus = state.attendance[key];
            
            if (!currentStatus && isExcusedTime(student)) {
                currentStatus = 'excused';
            }
            
            // ê²°ì„ ì‹œê°„ì´ ì§€ë‚¬ì„ ë•Œ
            if (isAbsentTime()) {
                // ìë™ ê²°ì„ëœ ìƒíƒœì—ì„œ ì²˜ìŒ í´ë¦­í•˜ë©´ ì§€ê°ìœ¼ë¡œ ë³€ê²½
                if (currentStatus === 'absent' && !state.attendance[key + '_manual']) {
                    state.attendance[key] = 'late';
                    state.attendance[key + '_manual'] = true; // ìˆ˜ë™ ë³€ê²½ í‘œì‹œ
                    renderTable();
                    return;
                }
                // ì§€ê°ìœ¼ë¡œ ê³ ì • (ë” ì´ìƒ ë³€ê²½ ë¶ˆê°€)
                return;
            }
            
            if (!currentStatus && isLateTime()) {
                state.attendance[key] = 'late';
                renderTable();
                return;
            }
            
            let statuses;
            if (isLateTime()) {
                statuses = ['none', 'late', 'absent', 'excused'];
            } else {
                statuses = ['none', 'present', 'late', 'absent', 'excused'];
            }
            
            const currentIndex = statuses.indexOf(currentStatus || 'none');
            const nextStatus = statuses[(currentIndex + 1) % statuses.length];
            
            if (nextStatus === 'none') {
                delete state.attendance[key];
            } else {
                state.attendance[key] = nextStatus;
            }
            
            renderTable();
        }

        function getAttendanceStatus(í•™ë²ˆ, student) {
            const key = `${state.date}-${state.time}-${í•™ë²ˆ}`;
            let status = state.attendance[key];
            
            if (!status && isExcusedTime(student)) {
                status = 'excused';
            }
            
            status = status || 'none';
            
            const statusMap = {
                'present': { text: 'ì¶œì„', class: 'bg-green' },
                'late': { text: 'ì§€ê°', class: 'bg-orange' },
                'absent': { text: 'ê²°ì„', class: 'bg-red' },
                'excused': { text: 'ë¶ˆì°¸', class: 'bg-gray' },
                'none': { text: 'ë¯¸ì²´í¬', class: 'bg-light' }
            };
            
            return statusMap[status];
        }

        function renderTable() {
            const data = getDisplayData();
            const tbody = document.getElementById('studentTable');
            tbody.innerHTML = '';
            
            data.forEach(student => {
                const status = getAttendanceStatus(student.í•™ë²ˆ, student);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.í•™ë²ˆ}</td>
                    <td style="font-weight: 500;">${student.ì´ë¦„}</td>
                    <td class="center">
                        <button class="attendance-btn ${status.class}" onclick="toggleAttendance('${student.í•™ë²ˆ}', ${JSON.stringify(student).replace(/"/g, '&quot;')})">
                            ${status.text}
                        </button>
                    </td>
                    <td class="center ${student.ë¶ˆì°¸ !== '-' ? 'excused-info' : ''}" style="color: ${student.ë¶ˆì°¸ !== '-' ? '#dc2626' : '#9ca3af'};">
                        ${student.ë¶ˆì°¸}
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            document.getElementById('totalCount').textContent = data.length;
        }

        function downloadCSV() {
            const data = getDisplayData();
            const dayOfWeek = getDayOfWeek(state.date);
            const headers = ['ë‚ ì§œ', 'ìš”ì¼', 'ì‹œê°„', 'í•™ë²ˆ', 'ì´ë¦„', 'ì¶œì„ìƒíƒœ'];
            const rows = data.map(student => {
                const status = getAttendanceStatus(student.í•™ë²ˆ, student);
                return [state.date, dayOfWeek, state.time, student.í•™ë²ˆ, student.ì´ë¦„, status.text];
            });
            
            const csvContent = [headers, ...rows].map(row => row.join(',')).join('\n');
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ì¶œì„ì²´í¬_${state.date}_${state.time}.csv`;
            link.click();
        }

        function resetAttendance() {
            try {
                const password = prompt('ì´ˆê¸°í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                
                // ë¹„ë°€ë²ˆí˜¸: 1234 (ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½ ê°€ëŠ¥)
                if (password === '1234') {
                    if (confirm('ì •ë§ë¡œ ëª¨ë“  ì¶œì„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        state.attendance = {};
                        renderTable();
                        alert('ì¶œì„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                } else if (password !== null) {
                    alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Reset error:', error);
                alert('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
        window.resetAttendance = resetAttendance;
        window.downloadCSV = downloadCSV;

        init();
    </script>
</body>
</html>